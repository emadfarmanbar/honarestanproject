<% var veteranSectionDisplay=(formData && (formData.isVeteranFamily==='yes' || formData.isVeteranFamily===true || formData.isVeteranFamily==='true' )) ? 'block' : 'none' ; %>
<% var parentTeacherDisplay=(formData && (formData.parentTeacher==='yes' || formData.parentTeacher===true )) ? 'block' : 'none' ; %>
<% var disabilitySectionDisplay=(formData && (formData.physicalStatus==='disabled' || formData.physicalStatus===true )) ? 'block' : 'none' ; %>
<% var workingOutsideDisplay=(formData && formData.workingOutside==='yes') ? 'block' : 'none' ; %>
<% var sportsRankDisplay=(formData && formData.sportsRank==='yes') ? 'block' : 'none' ; %>
<% var artRankDisplay=(formData && formData.artRank==='yes') ? 'block' : 'none' ; %>
<% var specialSkillDisplay=(formData && formData.specialSkill==='yes') ? 'block' : 'none' ; %>
<!DOCTYPE html>
<html lang="fa" dir="rtl">

<head>
  <meta charset="UTF-8">
  <title>مرحله ۶: اطلاعات تکمیلی هنرجو | سامانه ثبت‌نام هنرستان آسودگی</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Google Fonts - Vazir -->
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">
  <!-- Tailwind Config -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: {
            sans: ['Vazirmatn', 'sans-serif'],
          },
          colors: {
            primary: {
              light: '#4f46e5',
              DEFAULT: '#4338ca',
              dark: '#3730a3',
            },
            secondary: {
              light: '#f59e0b',
              DEFAULT: '#d97706',
              dark: '#b45309',
            },
          },
          boxShadow: {
            'neumorphism': '8px 8px 16px #d1d9e6, -8px -8px 16px #ffffff',
            'neumorphism-inset': 'inset 4px 4px 8px #d1d9e6, inset -4px -4px 8px #ffffff',
          },
          animation: {
            'fade-in': 'fadeIn 0.3s ease-in-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0', transform: 'translateY(10px)' },
              '100%': { opacity: '1', transform: 'translateY(0)' },
            },
          },
        },
      },
    };
  </script>
  <style>
    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.9);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border-radius: 1.5rem;
      border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .btn-glow:hover {
      box-shadow: 0 0 15px rgba(67, 56, 202, 0.6);
    }

    .input-field {
      transition: all 0.3s ease;
      background: rgba(255, 255, 255, 0.8);
    }

    .input-field:focus {
      box-shadow: 0 0 0 3px rgba(67, 56, 202, 0.2);
    }

    .progress-bar {
      height: 6px;
      background: linear-gradient(90deg, #4338ca 0%, #d97706 100%);
      border-radius: 3px;
    }

    .radio-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .radio-card:hover {
      transform: translateY(-2px);
    }

    .radio-card.selected {
      border-color: #4338ca;
      background-color: rgba(67, 56, 202, 0.05);
    }

    .select-arrow {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
      background-position: left 0.5rem center;
      background-repeat: no-repeat;
      background-size: 1.5em 1.5em;
    }

    .checkbox-item:hover {
      background-color: rgba(67, 56, 202, 0.05);
    }

    .fade-in {
      animation: fadeIn 0.3s ease-in-out;
    }
  </style>
</head>

<body class="font-sans min-h-screen flex flex-col items-center justify-center p-4">
  <!-- Main Card -->
  <div class="glass-card w-full max-w-4xl p-8 shadow-2xl rounded-2xl overflow-hidden relative">
    <!-- Decorative Elements -->
    <div class="absolute -top-10 -right-10 w-20 h-20 bg-primary-light rounded-full opacity-10"></div>
    <div class="absolute -bottom-10 -left-10 w-20 h-20 bg-secondary-light rounded-full opacity-10"></div>

    <!-- Progress Bar -->
    <div class="mb-8">
      <div class="flex justify-between items-center mb-2">
        <span class="text-sm font-medium text-gray-600">مرحله ۶ از ۶</span>
        <span class="text-sm font-medium text-primary">۱۰۰% تکمیل شده</span>
      </div>
      <div class="w-full bg-gray-200 rounded-full h-2.5">
        <div class="progress-bar h-2.5 rounded-full" style="width: 100%"></div>
      </div>
    </div>

    <!-- Header -->
    <div class="text-center mb-8">
      <div class="w-16 h-16 bg-white rounded-full shadow-neumorphism flex items-center justify-center mx-auto mb-4">
        <i class="fas fa-user-graduate text-primary text-2xl"></i>
      </div>
      <h1 class="text-2xl font-black text-gray-800 mb-2">
        اطلاعات تکمیلی هنرجو
      </h1>
      <p class="text-gray-600">لطفاً اطلاعات تکمیلی دانش‌آموز را با دقت وارد نمایید</p>
    </div>

    <!-- Error Message -->
    <% if (error) { %>
      <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mb-6 flex items-start">
        <i class="fas fa-exclamation-circle text-red-500 mt-1 ml-2"></i>
        <div>
          <p class="font-medium">
            <%= error %>
          </p>
        </div>
      </div>
    <% } %>

    <!-- Form -->
    <form method="POST" action="/step6" class="space-y-6">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">

      <!-- Section 1: Family Info -->
      <div class="bg-white/80 rounded-xl p-6 shadow-neumorphism">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-home text-blue-500 ml-2"></i>
          اطلاعات خانوادگی
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Living With -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">زندگی با</label>
            <select name="livingWith" required
              class="select-arrow input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary">
              <option value="">انتخاب کنید</option>
              <option value="fatherAndMother" <%=formData.livingWith==='fatherAndMother' ? 'selected' : '' %>>پدر و مادر</option>
              <option value="father" <%=formData.livingWith==='father' ? 'selected' : '' %>>پدر</option>
              <option value="mother" <%=formData.livingWith==='mother' ? 'selected' : '' %>>مادر</option>
              <option value="others" <%=formData.livingWith==='others' ? 'selected' : '' %>>سایرین</option>
            </select>
            <div class="living-with-others mt-2" style="display: <%= formData.livingWith==='others' ? 'block' : 'none' %>;">
              <input type="text" name="livingWithOthers" placeholder="لطفاً مشخص کنید"
                value="<%= formData.livingWithOthers || '' %>"
                class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary fade-in" />
            </div>
          </div>

          <!-- Parents Status -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">وضعیت والدین</label>
            <select name="parentsStatus" required
              class="select-arrow input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary">
              <option value="">انتخاب کنید</option>
              <option value="livingTogether" <%=formData.parentsStatus==='livingTogether' ? 'selected' : '' %>>با هم زندگی می‌کنند</option>
              <option value="notLivingTogether" <%=formData.parentsStatus==='notLivingTogether' ? 'selected' : '' %>>با هم زندگی نمی‌کنند</option>
            </select>
          </div>

          <!-- Divorced Parents -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">طلاق والدین</label>
            <div class="flex items-center">
              <label class="inline-flex items-center cursor-pointer mr-4">
                <input type="checkbox" name="divorcedParents" value="yes" <%=formData.divorcedParents==='yes' ? 'checked' : '' %>
                  class="form-checkbox h-5 w-5 text-primary rounded focus:ring-primary">
                <span class="mr-2">بله</span>
              </label>
            </div>
          </div>

          <!-- Deceased Parents -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">فوت والدین</label>
            <div class="flex items-center">
              <label class="inline-flex items-center cursor-pointer mr-4">
                <input type="checkbox" name="deceasedParents" value="yes" <%=formData.deceasedParents==='yes' ? 'checked' : '' %>
                  class="form-checkbox h-5 w-5 text-primary rounded focus:ring-primary">
                <span class="mr-2">بله</span>
              </label>
            </div>
            <div class="deceased-explanation mt-2" style="display: <%= formData.deceasedParents==='yes' ? 'block' : 'none' %>;">
              <label class="block text-gray-600 mb-1">کدام والد فوت شده است؟</label>
              <label class="inline-flex items-center mr-4">
                <input type="radio" name="deceasedExplanation" value="پدر" <%=formData.deceasedExplanation==='پدر' ? 'checked' : '' %>
                  class="form-radio text-primary ml-1"> پدر
              </label>
              <label class="inline-flex items-center mr-4">
                <input type="radio" name="deceasedExplanation" value="مادر" <%=formData.deceasedExplanation==='مادر' ? 'checked' : '' %>
                  class="form-radio text-primary ml-1"> مادر
              </label>
              <label class="inline-flex items-center mr-4">
                <input type="radio" name="deceasedExplanation" value="هر دو" <%=formData.deceasedExplanation==='هر دو' ? 'checked' : '' %>
                  class="form-radio text-primary ml-1"> هر دو
              </label>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 2: Skills & Achievements -->
      <div class="bg-white/80 rounded-xl p-6 shadow-neumorphism">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-trophy text-yellow-500 ml-2"></i>
          مهارت‌ها و دستاوردها
        </h2>

        <!-- Working Outside -->
        <div class="mb-4">
          <label class="block text-gray-700 mb-2 font-medium">اشتغال خارج از تحصیل</label>
          <div class="grid grid-cols-2 gap-3">
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.workingOutside === 'no' ? 'selected border-primary' : '' %>"
              id="workingNoLabel">
              <input type="radio" name="workingOutside" value="no" <%=formData.workingOutside==='no' ? 'checked' : '' %>
                required class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-times-circle text-red-500 ml-2"></i>
                <span>نمی‌باشد</span>
              </div>
            </label>
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.workingOutside === 'yes' ? 'selected border-primary' : '' %>"
              id="workingYesLabel">
              <input type="radio" name="workingOutside" value="yes" <%=formData.workingOutside==='yes' ? 'checked' : '' %>
                class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-check-circle text-green-500 ml-2"></i>
                <span>می‌باشد</span>
              </div>
            </label>
          </div>
          <div class="working-explanation mt-2" style="display: <%= workingOutsideDisplay %>;">
            <textarea name="workingExplanation" placeholder="توضیح دهید..."
              class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary fade-in"><%= formData.workingExplanation || '' %></textarea>
          </div>
        </div>

        <!-- Sports Rank -->
        <div class="mb-4">
          <label class="block text-gray-700 mb-2 font-medium">مقام ورزشی</label>
          <div class="grid grid-cols-2 gap-3">
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.sportsRank === 'no' ? 'selected border-primary' : '' %>"
              id="sportsNoLabel">
              <input type="radio" name="sportsRank" value="no" <%=formData.sportsRank==='no' ? 'checked' : '' %>
                required class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-times-circle text-red-500 ml-2"></i>
                <span>ندارد</span>
              </div>
            </label>
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.sportsRank === 'yes' ? 'selected border-primary' : '' %>"
              id="sportsYesLabel">
              <input type="radio" name="sportsRank" value="yes" <%=formData.sportsRank==='yes' ? 'checked' : '' %>
                class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-medal text-yellow-500 ml-2"></i>
                <span>دارد</span>
              </div>
            </label>
          </div>
          <div class="sports-rank-desc mt-2" style="display: <%= sportsRankDisplay %>;">
            <textarea name="sportsRankDesc" placeholder="عنوان رشته و مقام"
              class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary fade-in"><%= formData.sportsRankDesc || '' %></textarea>
          </div>
        </div>

        <!-- Art Rank -->
        <div class="mb-4">
          <label class="block text-gray-700 mb-2 font-medium">مقام فرهنگی/هنری</label>
          <div class="grid grid-cols-2 gap-3">
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.artRank === 'no' ? 'selected border-primary' : '' %>"
              id="artNoLabel">
              <input type="radio" name="artRank" value="no" <%=formData.artRank==='no' ? 'checked' : '' %>
                required class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-times-circle text-red-500 ml-2"></i>
                <span>ندارد</span>
              </div>
            </label>
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.artRank === 'yes' ? 'selected border-primary' : '' %>"
              id="artYesLabel">
              <input type="radio" name="artRank" value="yes" <%=formData.artRank==='yes' ? 'checked' : '' %>
                class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-palette text-purple-500 ml-2"></i>
                <span>دارد</span>
              </div>
            </label>
          </div>
          <div class="art-rank-desc mt-2" style="display: <%= artRankDisplay %>;">
            <textarea name="artRankDesc" placeholder="عنوان رشته و مقام"
              class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary fade-in"><%= formData.artRankDesc || '' %></textarea>
          </div>
        </div>

        <!-- Special Skills -->
        <div>
          <label class="block text-gray-700 mb-2 font-medium">مهارت خاص</label>
          <div class="grid grid-cols-2 gap-3">
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.specialSkill === 'no' ? 'selected border-primary' : '' %>"
              id="skillNoLabel">
              <input type="radio" name="specialSkill" value="no" <%=formData.specialSkill==='no' ? 'checked' : '' %>
                required class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-times-circle text-red-500 ml-2"></i>
                <span>ندارد</span>
              </div>
            </label>
            <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.specialSkill === 'yes' ? 'selected border-primary' : '' %>"
              id="skillYesLabel">
              <input type="radio" name="specialSkill" value="yes" <%=formData.specialSkill==='yes' ? 'checked' : '' %>
                class="hidden" />
              <div class="flex items-center">
                <i class="fas fa-star text-blue-500 ml-2"></i>
                <span>دارد</span>
              </div>
            </label>
          </div>
          <div class="special-skill-desc mt-2" style="display: <%= specialSkillDisplay %>;">
            <textarea name="specialSkillDesc" placeholder="عنوان مهارت و زمینه کاری"
              class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary fade-in"><%= formData.specialSkillDesc || '' %></textarea>
          </div>
        </div>
      </div>

      <!-- Section 3: Personal Details -->
      <div class="bg-white/80 rounded-xl p-6 shadow-neumorphism">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-id-card text-green-500 ml-2"></i>
          مشخصات فردی
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Sadat -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">خانواده سادات</label>
            <div class="grid grid-cols-2 gap-3">
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.isSadat === 'no' ? 'selected border-primary' : '' %>"
                id="sadatNoLabel">
                <input type="radio" name="isSadat" value="no" <%=formData.isSadat==='no' ? 'checked' : '' %>
                  required class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-times-circle text-red-500 ml-2"></i>
                  <span>نمی‌باشد</span>
                </div>
              </label>
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.isSadat === 'yes' ? 'selected border-primary' : '' %>"
                id="sadatYesLabel">
                <input type="radio" name="isSadat" value="yes" <%=formData.isSadat==='yes' ? 'checked' : '' %>
                  class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 ml-2"></i>
                  <span>می‌باشد</span>
                </div>
              </label>
            </div>
          </div>

          <!-- Writing Hand -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">دست غالب</label>
            <div class="grid grid-cols-2 gap-3">
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.writingHand === 'right' ? 'selected border-primary' : '' %>"
                id="handRightLabel">
                <input type="radio" name="writingHand" value="right" <%=formData.writingHand==='right' ? 'checked' : '' %>
                  required class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-hand-point-right text-blue-500 ml-2"></i>
                  <span>راست‌دست</span>
                </div>
              </label>
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.writingHand === 'left' ? 'selected border-primary' : '' %>"
                id="handLeftLabel">
                <input type="radio" name="writingHand" value="left" <%=formData.writingHand==='left' ? 'checked' : '' %>
                  class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-hand-point-left text-blue-500 ml-2"></i>
                  <span>چپ‌دست</span>
                </div>
              </label>
            </div>
          </div>

          <!-- Parent Teacher -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">والدین فرهنگی</label>
            <div class="grid grid-cols-2 gap-3">
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.parentTeacher === 'no' ? 'selected border-primary' : '' %>"
                id="teacherNoLabel">
                <input type="radio" name="parentTeacher" value="no" <%=formData.parentTeacher==='no' ? 'checked' : '' %>
                  required class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-times-circle text-red-500 ml-2"></i>
                  <span>نمی‌باشد</span>
                </div>
              </label>
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.parentTeacher === 'yes' ? 'selected border-primary' : '' %>"
                id="teacherYesLabel">
                <input type="radio" name="parentTeacher" value="yes" <%=formData.parentTeacher==='yes' ? 'checked' : '' %>
                  class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-chalkboard-teacher text-indigo-500 ml-2"></i>
                  <span>می‌باشد</span>
                </div>
              </label>
            </div>
          </div>

          <!-- Staff Codes -->
          <div class="staff-codes grid grid-cols-1 md:grid-cols-2 gap-4 mt-2" style="display: <%= parentTeacherDisplay %>;">
            <div>
              <label class="block text-gray-700 mb-2 font-medium">کد پرسنلی پدر</label>
              <div class="relative">
                <input type="text" name="fatherStaffCode" value="<%= formData.fatherStaffCode || '' %>"
                  pattern="[0-9]*" title="لطفاً فقط عدد وارد کنید"
                  class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary pr-10 fade-in">
                <div class="absolute left-3 top-3 text-gray-400">
                  <i class="fas fa-id-card"></i>
                </div>
              </div>
            </div>
            <div>
              <label class="block text-gray-700 mb-2 font-medium">کد پرسنلی مادر</label>
              <div class="relative">
                <input type="text" name="motherStaffCode" value="<%= formData.motherStaffCode || '' %>"
                  pattern="[0-9]*" title="لطفاً فقط عدد وارد کنید"
                  class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary pr-10 fade-in">
                <div class="absolute left-3 top-3 text-gray-400">
                  <i class="fas fa-id-card"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 4: Background Info -->
      <div class="bg-white/80 rounded-xl p-6 shadow-neumorphism">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-info-circle text-purple-500 ml-2"></i>
          اطلاعات پایه
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Religion -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">دین و مذهب</label>
            <select name="religion" required
              class="select-arrow input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary">
              <option value="">انتخاب کنید</option>
              <option value="shia" <%=formData.religion==='shia' ? 'selected' : '' %>>اسلام (تشیع)</option>
              <option value="sunni" <%=formData.religion==='sunni' ? 'selected' : '' %>>اسلام (تسنن)</option>
              <option value="jewish" <%=formData.religion==='jewish' ? 'selected' : '' %>>یهودی</option>
              <option value="christian" <%=formData.religion==='christian' ? 'selected' : '' %>>مسیحی</option>
              <option value="zoroastrian" <%=formData.religion==='zoroastrian' ? 'selected' : '' %>>زرتشتی</option>
              <option value="other" <%=formData.religion==='other' ? 'selected' : '' %>>سایر</option>
            </select>
            <div class="religion-other mt-2" style="display: <%= formData.religion==='other' ? 'block' : 'none' %>;">
              <input type="text" name="religionOther" placeholder="لطفاً مشخص کنید"
                value="<%= formData.religionOther || '' %>"
                class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary fade-in" />
            </div>
          </div>

          <!-- Nationality -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">تابعیت</label>
            <select name="nationality" required
              class="select-arrow input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary">
              <option value="">انتخاب کنید</option>
              <option value="iranian" <%=formData.nationality==='iranian' ? 'selected' : '' %>>ایرانی</option>
              <option value="nonIranian" <%=formData.nationality==='nonIranian' ? 'selected' : '' %>>غیر ایرانی</option>
            </select>
            <div class="nationality-country mt-2" style="display: <%= formData.nationality==='nonIranian' ? 'block' : 'none' %>;">
              <input type="text" name="nationalityCountry" placeholder="نام کشور را مشخص کنید"
                value="<%= formData.nationalityCountry || '' %>"
                class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary fade-in" />
            </div>
          </div>

          <!-- Insurance -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">بیمه</label>
            <select name="insurance" required
              class="select-arrow input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary">
              <option value="">انتخاب کنید</option>
              <option value="socialSecurity" <%=formData.insurance==='socialSecurity' ? 'selected' : '' %>>تأمین اجتماعی</option>
              <option value="healthService" <%=formData.insurance==='healthService' ? 'selected' : '' %>>خدمات درمانی</option>
              <option value="none" <%=formData.insurance==='none' ? 'selected' : '' %>>فاقد بیمه</option>
            </select>
          </div>

          <!-- Support Org -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">نهاد حمایتی</label>
            <select name="supportOrg" required
              class="select-arrow input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary">
              <option value="">انتخاب کنید</option>
              <option value="none" <%=formData.supportOrg==='none' ? 'selected' : '' %>>نمی‌باشد</option>
              <option value="behzisti" <%=formData.supportOrg==='behzisti' ? 'selected' : '' %>>بهزیستی</option>
              <option value="komite" <%=formData.supportOrg==='komite' ? 'selected' : '' %>>کمیته امداد</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Section 5: Veteran Status -->
      <div class="bg-white/80 rounded-xl p-6 shadow-neumorphism">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-ribbon text-red-500 ml-2"></i>
          وضعیت ایثارگری
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Is Veteran Family -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">خانواده ایثارگر</label>
            <div class="grid grid-cols-2 gap-3">
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.isVeteranFamily === 'no' ? 'selected border-primary' : '' %>">
                <input type="radio" name="isVeteranFamily" value="no" <%=formData.isVeteranFamily==='no' ? 'checked' : '' %>
                  required class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-times-circle text-red-500 ml-2"></i>
                  <span>نمی‌باشد</span>
                </div>
              </label>
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.isVeteranFamily === 'yes' ? 'selected border-primary' : '' %>">
                <input type="radio" name="isVeteranFamily" value="yes" <%=formData.isVeteranFamily==='yes' ? 'checked' : '' %>
                  class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 ml-2"></i>
                  <span>می‌باشد</span>
                </div>
              </label>
            </div>
          </div>

          <!-- Veteran Priority Section -->
          <div id="veteranPrioritySection" class="col-span-1 md:col-span-2 fade-in" style="display: <%= veteranSectionDisplay %>;">
            <label class="block text-gray-700 mb-2 font-bold text-lg flex items-center">
              <i class="fas fa-award text-red-400 ml-2"></i>
              اولویت ایثارگری
            </label>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3">
              <% const veteranOptions=[
                {v: 'childOfMartyr', t: 'فرزند شهید', icon: 'fa-user-shield', color: 'text-red-500'},
                {v: 'childOfDisabledBelow25', t: 'فرزند جانباز زیر 25%', icon: 'fa-wheelchair-move', color: 'text-orange-500'},
                {v: 'childOfDisabledAbove25', t: 'فرزند جانباز بالای 25%', icon: 'fa-wheelchair', color: 'text-amber-500'},
                {v: 'childOfDisabledAbove50', t: 'فرزند جانباز بالای 50%', icon: 'fa-wheelchair', color: 'text-yellow-500'},
                {v: 'childOfDisabledDeceased', t: 'فرزند جانباز متوفی', icon: 'fa-user-injured', color: 'text-purple-500'},
                {v: 'childOfFreed', t: 'فرزند آزاده', icon: 'fa-dove', color: 'text-blue-500'},
                {v: 'childOfBasiji', t: 'فرزند رزمنده بسیجی', icon: 'fa-helmet-safety', color: 'text-green-500'},
                {v: 'brotherOfMartyr', t: 'برادر شهید', icon: 'fa-user-friends', color: 'text-pink-500'},
                {v: 'grandchildOfMartyr', t: 'نوه شهید', icon: 'fa-baby', color: 'text-indigo-500'},
                {v: 'nephewOfMartyr', t: 'برادرزاده/خواهرزاده شهید', icon: 'fa-users', color: 'text-cyan-500'},
                {v: 'others', t: 'سایرین', icon: 'fa-ellipsis-h', color: 'text-gray-500'}
              ];
              veteranOptions.forEach(function(opt) { %>
                <label class="radio-card flex items-center gap-2 p-3 border-2 rounded-xl transition-all cursor-pointer <%= formData.veteranPriority === opt.v ? 'selected border-primary bg-primary/5' : '' %>">
                  <input type="radio" name="veteranPriority" value="<%= opt.v %>" <%=formData.veteranPriority===opt.v ? 'checked' : '' %>
                    class="hidden" />
                  <i class="fas <%= opt.icon %> <%= opt.color %> text-lg ml-2"></i>
                  <span class="font-medium text-sm">
                    <%= opt.t %>
                  </span>
                </label>
              <% }) %>
            </div>

            <div id="veteranPriorityOthersInput" class="mt-4 <%= formData.veteranPriority === 'others' ? '' : 'hidden' %> fade-in">
              <input type="text" name="veteranPriorityOthers" placeholder="اگر سایرین، مشخص کنید"
                value="<%= formData.veteranPriorityOthers || '' %>"
                class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary" />
            </div>
          </div>
        </div>
      </div>

      <!-- Section 6: Health Status -->
      <div class="bg-white/80 rounded-xl p-6 shadow-neumorphism">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-heartbeat text-pink-500 ml-2"></i>
          وضعیت جسمانی
        </h2>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Physical Status -->
          <div>
            <label class="block text-gray-700 mb-2 font-medium">وضعیت سلامت</label>
            <div class="grid grid-cols-2 gap-3">
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.physicalStatus === 'healthy' ? 'selected border-primary' : '' %>">
                <input type="radio" name="physicalStatus" value="healthy" <%=formData.physicalStatus==='healthy' ? 'checked' : '' %>
                  required class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-check-circle text-green-500 ml-2"></i>
                  <span>سالم</span>
                </div>
              </label>
              <label class="radio-card flex items-center justify-center p-3 border-2 rounded-xl transition-all <%= formData.physicalStatus === 'disabled' ? 'selected border-primary' : '' %>">
                <input type="radio" name="physicalStatus" value="disabled" <%=formData.physicalStatus==='disabled' ? 'checked' : '' %>
                  class="hidden" />
                <div class="flex items-center">
                  <i class="fas fa-wheelchair text-orange-500 ml-2"></i>
                  <span>بیمار/معلول</span>
                </div>
              </label>
            </div>
          </div>

          <!-- Disabilities -->
          <div id="disabilitySection" class="col-span-1 md:col-span-2 fade-in" style="display: <%= disabilitySectionDisplay %>;">
            <label class="block text-gray-700 mb-2 font-medium">نوع بیماری/معلولیت</label>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
              <% const disabilitiesList=[
                'معلول جسمی حرکتی', 'ناشنوا', 'نیمه شنوا', 'نیمه بینا', 'نابینا',
                'صرع', 'آسم', 'بیماری قلبی', 'فشار خون', 'دیابت', 'اختلال یادگیری', 'پیش فعالی'
              ];
              const selectedDisabilities=Array.isArray(formData.disabilities) ? formData.disabilities : (formData.disabilities ? [formData.disabilities] : []);
              disabilitiesList.forEach(function(disease) { %>
                <label class="checkbox-item inline-flex items-center p-2 rounded cursor-pointer hover:bg-primary/5 transition-colors">
                  <input type="checkbox" name="disabilities[]" value="<%= disease %>" <%=selectedDisabilities.includes(disease) ? 'checked' : '' %>
                    class="form-checkbox h-4 w-4 text-primary rounded focus:ring-primary">
                  <span class="mr-2 text-sm">
                    <%= disease %>
                  </span>
                </label>
              <% }) %>
            </div>
          </div>
        </div>
      </div>

      <!-- Section 7: Additional Info -->
      <div class="bg-white/80 rounded-xl p-6 shadow-neumorphism">
        <h2 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
          <i class="fas fa-edit text-blue-500 ml-2"></i>
          اطلاعات آموزشی هنرجو
        </h2>
        <div class="mb-4">
          <label class="block text-gray-700 mb-2 font-medium">معدل کل سال نهم تحصیلی</label>
          <div class="relative">
            <input type="text" name="ninthGradeAverage" value="<%= formData.ninthGradeAverage || '' %>"
              pattern="[0-9]{1,2}(\.[0-9]{1,2})?"
              title="لطفاً یک عدد بین 0 تا 20 با حداکثر دو رقم اعشار وارد کنید"
              class="input-field w-full px-4 py-3 rounded-xl border-0 shadow-neumorphism-inset focus:ring-2 focus:ring-primary pr-10 fade-in"
              placeholder="مثال: ۱۹.۵۰">
            <div class="absolute left-3 top-3 text-gray-400">
              <i class="fas fa-percentage"></i>
            </div>
          </div>
          <p class="text-xs text-gray-500 mt-1">لطفاً معدل را به صورت عددی وارد کنید (مثال: 18.75)</p>
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 mb-2 font-medium">انضباط سال نهم تحصیلی</label>
          <div class="flex flex-wrap gap-4">
            <label class="inline-flex items-center">
              <input type="radio" name="ninthGradeDiscipline" value="عالی" <%=formData.ninthGradeDiscipline==='عالی' ? 'checked' : '' %>
                class="form-radio text-primary ml-1"> عالی
            </label>
            <label class="inline-flex items-center">
              <input type="radio" name="ninthGradeDiscipline" value="خیلی خوب" <%=formData.ninthGradeDiscipline==='خیلی خوب' ? 'checked' : '' %>
                class="form-radio text-primary ml-1"> خیلی خوب
            </label>
            <label class="inline-flex items-center opacity-50 cursor-not-allowed">
              <input type="radio" disabled name="ninthGradeDiscipline" value="خوب"> خوب
            </label>
            <label class="inline-flex items-center opacity-50 cursor-not-allowed">
              <input type="radio" disabled name="ninthGradeDiscipline" value="قابل قبول"> قابل قبول
            </label>
            <label class="inline-flex items-center opacity-50 cursor-not-allowed">
              <input type="radio" disabled name="ninthGradeDiscipline" value="نیاز به تلاش بیشتر"> نیاز به تلاش بیشتر
            </label>
          </div>
          <div class="text-red-500 text-sm mt-2">در صورت انتخاب گزینه‌ای غیر از "خیلی خوب" یا "عالی"، ثبت‌نام انجام نخواهد شد.</div>
        </div>
      </div>

      <!-- Submit Button -->
      <div class="text-center mt-6">
        <button type="submit"
          class="btn-glow w-full max-w-xs mx-auto bg-gradient-to-r from-primary to-secondary text-white py-3 px-6 rounded-xl font-bold hover:opacity-90 transition-all shadow-lg">
          <i class="fas fa-check ml-2"></i>
          تکمیل ثبت‌نام
        </button>
      </div>
    </form>
  </div>

  <!-- Back Button -->
  <a href="/step5" class="mt-6 text-primary font-medium flex items-center">
    <i class="fas fa-arrow-right ml-1"></i>
    بازگشت به مرحله قبل
  </a>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // تابع برای نمایش/مخفی کردن فیلدهای وابسته
      function toggleDependentFields(name, value) {
        // Handle livingWith others field
        if (name === 'livingWith') {
          const othersField = document.querySelector('.living-with-others');
          if (othersField) {
            othersField.style.display = value === 'others' ? 'block' : 'none';
            othersField.classList.toggle('fade-in', value === 'others');
          }
        }

        // Handle religion other field
        if (name === 'religion') {
          const religionOtherField = document.querySelector('.religion-other');
          if (religionOtherField) {
            religionOtherField.style.display = value === 'other' ? 'block' : 'none';
            religionOtherField.classList.toggle('fade-in', value === 'other');
          }
        }

        // Handle nationality country field
        if (name === 'nationality') {
          const countryField = document.querySelector('.nationality-country');
          if (countryField) {
            countryField.style.display = value === 'nonIranian' ? 'block' : 'none';
            countryField.classList.toggle('fade-in', value === 'nonIranian');
          }
        }

        // Handle parent teacher fields
        if (name === 'parentTeacher') {
          const staffFields = document.querySelector('.staff-codes');
          if (staffFields) {
            staffFields.style.display = value === 'yes' ? 'block' : 'none';
            staffFields.classList.toggle('fade-in', value === 'yes');
          }
        }

        // Handle veteran priority fields
        if (name === 'isVeteranFamily') {
          const veteranSection = document.getElementById('veteranPrioritySection');
          if (veteranSection) {
            veteranSection.style.display = value === 'yes' ? 'block' : 'none';
            veteranSection.classList.toggle('fade-in', value === 'yes');
          }
        }

        // Handle physical status fields
        if (name === 'physicalStatus') {
          const disabilitySection = document.getElementById('disabilitySection');
          if (disabilitySection) {
            disabilitySection.style.display = value === 'disabled' ? 'block' : 'none';
            disabilitySection.classList.toggle('fade-in', value === 'disabled');
          }
        }

        // Handle working outside explanation
        if (name === 'workingOutside') {
          const workingExplanation = document.querySelector('.working-explanation');
          if (workingExplanation) {
            workingExplanation.style.display = value === 'yes' ? 'block' : 'none';
            workingExplanation.classList.toggle('fade-in', value === 'yes');
          }
        }

        // Handle sports rank description
        if (name === 'sportsRank') {
          const sportsRankDesc = document.querySelector('.sports-rank-desc');
          if (sportsRankDesc) {
            sportsRankDesc.style.display = value === 'yes' ? 'block' : 'none';
            sportsRankDesc.classList.toggle('fade-in', value === 'yes');
          }
        }

        // Handle art rank description
        if (name === 'artRank') {
          const artRankDesc = document.querySelector('.art-rank-desc');
          if (artRankDesc) {
            artRankDesc.style.display = value === 'yes' ? 'block' : 'none';
            artRankDesc.classList.toggle('fade-in', value === 'yes');
          }
        }

        // Handle special skill description
        if (name === 'specialSkill') {
          const specialSkillDesc = document.querySelector('.special-skill-desc');
          if (specialSkillDesc) {
            specialSkillDesc.style.display = value === 'yes' ? 'block' : 'none';
            specialSkillDesc.classList.toggle('fade-in', value === 'yes');
          }
        }
      }

      // تابع برای نمایش/مخفی کردن فیلد سایرین در بخش ایثارگران
      function toggleVeteranOthersInput() {
        const othersRadio = document.querySelector('input[name="veteranPriority"][value="others"]');
        const inputDiv = document.getElementById('veteranPriorityOthersInput');
        if (othersRadio && othersRadio.checked) {
          inputDiv.classList.remove('hidden');
          inputDiv.classList.add('fade-in');
        } else {
          inputDiv.classList.add('hidden');
          inputDiv.classList.remove('fade-in');
        }
      }

      // Initialize radio card selections
      document.querySelectorAll('.radio-card').forEach(card => {
        card.addEventListener('click', function () {
          const input = this.querySelector('input');
          if (input) {
            // Unselect all cards with the same name
            document.querySelectorAll(`.radio-card input[name="${input.name}"]`).forEach(inp => {
              inp.closest('.radio-card').classList.remove('selected', 'border-primary');
            });

            // Select the clicked card
            this.classList.add('selected', 'border-primary');
            input.checked = true;

            // Toggle dependent fields
            toggleDependentFields(input.name, input.value);

            // Special handling for veteran priority
            if (input.name === 'veteranPriority') {
              toggleVeteranOthersInput();
            }
          }
        });
      });

      // Initialize checkbox selections
      document.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        checkbox.addEventListener('change', function () {
          const dependentField = this.closest('div').nextElementSibling;
          if (dependentField && dependentField.tagName === 'DIV') {
            dependentField.style.display = this.checked ? 'block' : 'none';
            dependentField.classList.toggle('fade-in', this.checked);
          }
        });
      });

      // Initialize all dependent fields
      document.querySelectorAll('input[type="radio"]:checked').forEach(radio => {
        toggleDependentFields(radio.name, radio.value);
      });

      // Initialize veteran section
      toggleVeteranOthersInput();

      // Validate average input
      const averageInput = document.querySelector('[name="ninthGradeAverage"]');
      if (averageInput) {
        averageInput.addEventListener('input', function (e) {
          this.value = this.value.replace(/[^0-9.]/g, '').replace(/(\..*)\./g, '$1');
          const value = parseFloat(this.value);
          if (value > 20) this.value = '20.00';
        });
      }

      // Validate staff code input
      const staffCodeInputs = document.querySelectorAll('[name="fatherStaffCode"], [name="motherStaffCode"]');
      staffCodeInputs.forEach(input => {
        input.addEventListener('input', function (e) {
          this.value = this.value.replace(/[^0-9]/g, '');
        });
      });

      // Initialize physical status section
      const physicalStatusSelect = document.querySelector('select[name="physicalStatus"]');
      if (physicalStatusSelect) {
        physicalStatusSelect.addEventListener('change', function () {
          toggleDependentFields('physicalStatus', this.value);
        });
      }
    });
  </script>
</body>

</html>